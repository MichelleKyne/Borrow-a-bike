{% extends "layout.html" %}

{% block title %}
    Map
{% endblock %}

{% block main %}
    <div id=select>
        <p>Please select a station</p>
        <select id="stations" name="stations"></select>
    </div>
    <!--    label for the parking slot toggle switch-->
    <label id="lblfilter1">Filter available parking stations only :</label>
    <!--    declare a input type checkbox for available parking slots which acts a toggle switch using css-->
    <div id="filter">
        <label class="toggle">
            <input id="slideparking" type="checkbox" display="none" onclick="slideparking_click()"><span class="slider"></span>
        </label>
    </div>

    <!--    label for the available bikes toggle switch-->
    <label id="lblfilter2">Filter available bike stations only :</label>
    <div id="filter2">
        <!--    declare another input type checkbox for available bikes which acts a toggle switch using css-->
        <label class="toggle">
            <input id="slidebikeavailable" type="checkbox" display="none" onclick="slidebikeavailable_click()"><span class="slider"></span>
        </label>
    </div>
    <div id="map"></div>

    <script>
        //<!--    create a variable to check the status of switch whether the it is on or off-->
        var parking_slots_filter = false;
        var bikes_available_filter = false;
    //<!--    create a function to show the markers acc to choise made-->
        function slidebikeavailable_click(){
    //<!--    check if the switch is on, if it is on change the variable status and call the map function-->
            if(document.getElementById("slidebikeavailable").checked == true)
            {
                bikes_available_filter = true;
            }
            else{
                bikes_available_filter = false;
            }
            initMap();
        }
        function slideparking_click(){
            if(document.getElementById("slideparking").checked == true)
            {
                parking_slots_filter = true;
            }
            else{
                parking_slots_filter = false;
            }
            initMap();
        }
        let map;
        function initMap() {
            console.clear();
            fetch("/").then(response => {
                return response.json();
            }).then(data => {
                console.log(data);
            // map centered on Dublin
            map = new google.maps.Map(document.getElementById("map"), {
                center: {lat: 53.3470, lng: -6.2603},
                zoom: 13.5,
            });

            data.forEach(station => {
                dropDownList = document.getElementById("stations");
                // populate select element with station options
                var stOp = document.createElement("option");
                stOp.setAttribute("value",station.number);
                stOp.setAttribute("label",station.name);
                dropDownList.appendChild(stOp); 

                // create unique marker for each station
                const marker = new google.maps.Marker({
                    position: {lat: station.latitude, lng: station.longitude},
                    map: map});
                    // create an info window to display station information
                    var infowindow = new google.maps.InfoWindow({
                        content: '<h3>'+station.name+'</h3><p><b> Available bikes </b></p><p>'+station.bikes_free+'</p>'+
                                        '<p><b>Parking slots</b></p><p>'+station.stands_free,
                    });

    //                check if the variable is true and if the bike stands for any of the station is 0
                    if(parking_slots_filter == true && station.stands_free == 0){
    //                    if any of the station is not having parking slots, then hide that station marker
                        marker.setVisible(false);
                    }
    //                check if available bikes variable is true and if any station with available bikes as 0-->
                    if(bikes_available_filter == true && station.bikes_free == 0){
    //                    if any of the station is not having parking slots, then hide that station marker-->
                        marker.setVisible(false);
                    }

                    google.maps.event.addListener(marker,"mouseover",function() {
                        infowindow.open(map,marker);
                    })
                    google.maps.event.addListener(marker,"mouseout",function() {
                        infowindow.close();
                    })
                    google.maps.event.addListener(marker,"click",function() {
                        map.setZoom(15);
                        map.setCenter(marker.getPosition());
                    })
                })
            })
        }; 
</script>

<!-- Async script executes immediately and must be after any DOM elements used in callback. -->
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIjfPvdos15QUCS8h7xo-wHBao8qCGcwc&callback=initMap">
</script>
{% endblock %}