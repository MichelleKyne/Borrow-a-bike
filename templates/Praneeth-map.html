<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Flask app</title>
    <meta name="description" content="first page">
    <meta name="author" content="Praneeth">

    <img class="Logo" src="{{url_for('static', filename='dublinbikes-logo.png')}}" alt="Logo"/>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" type="text/css">
</head>
<body>
    <nav>
        <a>Prediction</a>
        <a>Statistics</a>
        <a>Home</a>
    </nav>

<!--    label for the parking slot toggle switch-->
    <label id="lblfilter1">Filter available parking stations only :</label>
<!--    declare a input type checkbox for available parking slots which acts a toggle switch using css-->
    <div id="filter">
        <label class="toggle">
            <input id="slideparking" type="checkbox" display="none" onclick="slideparking_click()"><span class="slider"></span>
        </label>
    </div>

    <!--    label for the available bikes toggle switch-->
    <label id="lblfilter2">Filter available bike stations only :</label>
    <div id="filter2">
        <!--    declare another input type checkbox for available bikes which acts a toggle switch using css-->
        <label class="toggle">
            <input id="slidebikeavailable" type="checkbox" display="none" onclick="slidebikeavailable_click()"><span class="slider"></span>
        </label>
    </div>
    <div id="map"></div>
    <footer><p>Copyright &copy; 2009-2021 Dublin Bikes</p></footer>
</body>
<script>
<!--    create a variable to check the status of switch whether the it is on or off-->
    var parking_slots_filter = false;
    var bikes_available_filter = false;

<!--    create a function to show the markers acc to choise made-->
    function slidebikeavailable_click(){

<!--    check if the switch is on, if it is on change the variable status and call the map function-->
        if(document.getElementById("slidebikeavailable").checked == true)
        {
            bikes_available_filter = true;

        }
        else{
            bikes_available_filter = false;
        }
        initMap();
    }

    function slideparking_click(){
        if(document.getElementById("slideparking").checked == true)
        {
            parking_slots_filter = true;

        }
        else{
            parking_slots_filter = false;
        }
        initMap();
    }


    let map;

    function initMap() {
        fetch("/stations").then(response => {
            return response.json();
        }).then(data => {
<!--        check the data in console for verification-->
            console.log("data: ",data);
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 53.349804, lng: -6.260310 },
                zoom: 12,
            });

            var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
            const icons = {
                Current: {
                    icon: iconBase + "Curr_location.png",
                },
            };



            var currWindow =false;
            data.forEach(station => {
                    const marker = new google.maps.Marker({

                            position: { lat: station.position_lat, lng: station.position_lng},
                            map: map,
                    });


                marker.addListener("click", () => {
                    if(currWindow){
                        currWindow.close();
                    }
                    const infowindow = new google.maps.InfoWindow({


                        content: '<h3>'+station.name+'</h3><p><b> Available bikes </b></p><p>'+station.available_bikes+'</p>'+
                                    '<p><b>Parking slots</b></p><p>'+station.available_bike_stands+'</p><p><b>Banking</b></p><p>'+station.banking+'</p>',
                     });
                    currWindow = infowindow;
                    infowindow.open(map, marker);
                });

<!--                check if the variable is true and if the bike stands for any of the station is 0-->
                if(parking_slots_filter == true && station.available_bike_stands == 0){

<!--                    if any of the station is not having parking slots, then hide that station marker-->
                    marker.setVisible(false);
                }

<!--                check if available bikes variable is true and if any station with available bikes as 0-->
                if(bikes_available_filter == true && station.available_bikes == 0){
<!--                    if any of the station is not having parking slots, then hide that station marker-->
                    marker.setVisible(false);
                }
            });

    }).catch(arr => {
        console.log("OOPS!", arr);
    })


    }



</script>
 <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQJByosOpAQ-jpcXETRMk5uyFWdHNXUrU&callback=initMap&libraries=&v=weekly"
      async
    ></script>
</html>